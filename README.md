# Avizo ‚Äî backend –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (Spring Boot)

Backend –¥–ª—è –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ —Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏, –∑–∞–≥—Ä—É–∑–∫–æ–π —Ñ–∞–π–ª–æ–≤, –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π. 
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞–¥—ë–∂–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (Transactional Outbox), –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤, observability, optimistic locking –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

---

### üöÄ TL;DR
–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ —Ñ–∏—á–µ–π

- **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è auth-–º–æ–¥–µ–ª—å** ‚Äî RSA‚Äë–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ JWT, –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π refresh‚Äëflow –≤ –ë–î —Å HMAC + optimistic locking –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç race conditions.
- **–ù–∞–¥—ë–∂–Ω—ã–π —Ñ–∞–π–ª–æ–≤—ã–π pipeline** ‚Äî presigned uploads ‚Üí –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (—á–∞—Å—Ç–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ, HEAD check, ImageIO) ‚Üí –ø—É–±–ª–∏–∫–∞—Ü–∏—è ‚Üí –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ S3. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–æ–Ω–æ–∫ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏ (processed) –∏ soft delete.
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ side‚Äëeffects** ‚Äî Transactional Outbox —Å retries, exponential backoff –∏ dead‚Äëletter –¥–ª—è eventual consistency.
- **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ (traceId, X-Request-ID), MDC‚Äë–ª–æ–≥–∏, –±—ã—Å—Ç—Ä—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.
- **Idempotency & defensive engineering** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, race conditions, soft-delete, –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** ‚Äî –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ JWT‚Äë–ø–∞—Ä—Å–µ—Ä–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ –¥–æ—Ä–æ–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏.

---

## ‚≠ê –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**1) Transactional Outbox ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ side‚Äëeffects**

- –°–æ–±—ã—Ç–∏–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é; OutboxProcessor –ø–æ–º–µ—á–∞–µ—Ç –≤ –±–∞–∑–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∫–∞–∫ ‚Äú–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ‚Äù (claim) –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –≤–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤—ã–∑—ã–≤–∞—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π OutboxDispatcher (–Ω–∞–ø—Ä–∏–º–µ—Ä, `AttachmentOutboxDispatcher` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ S3). –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–µ –ø–æ–º–µ—á–∞–µ—Ç—Å—è processed, –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è retry —Å exponential backoff; –ø–æ—Å–ª–µ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ ‚Äî dead-letter. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç eventual consistency –∏ –Ω–∞–¥—ë–∂–Ω—ã–µ side-effects.
- `OutboxProcessor` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ batching, —á—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç lock-–∫–æ–Ω—Ç–µ–Ω—à–Ω –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ–¥ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É.
  
**2) –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (RSA JWT + HMAC refresh)**

- Access —Ç–æ–∫–µ–Ω—ã –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è RSA. Refresh —Ç–æ–∫–µ–Ω—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ ‚Äî –≤ –ë–î –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `HMAC(token + pepper)` –∏ `jti`. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ refresh —Ç–æ–∫–µ–Ω–∞ –æ–Ω –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `revoked = true` –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–æ–∫–µ–Ω —Å—Ç—Ä–æ–≥–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–º –∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏ —É—Ç–µ—á–∫–µ.
- JwtEngineImpl –∫–µ—à–∏—Ä—É–µ—Ç JwtParser –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É –∫–ª—é—á—É, –¥–µ–ª–∞–µ—Ç pre-validation —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–æ–∫–µ–Ω–∞ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç claims(issuer, audience, time-skew). –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–æ–≤, —É–ø—Ä–æ—â–∞–µ—Ç —Ä–æ—Ç–∞—Ü–∏—é –∫–ª—é—á–µ–π –∏ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç malformed —Å—Ç—Ä–æ–∫ –¥–æ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞.

**3) –ù–∞–¥—ë–∂–Ω—ã–π presigned upload pipeline ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤**

- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–¥—ë—Ç –≤ –¥–≤–∞ —à–∞–≥–∞: presign —Å–æ–∑–¥–∞—ë—Ç —á–µ—Ä–Ω–æ–≤–æ–π Attachment (processed=false) –∏ –≤—ã–¥–∞—ë—Ç presigned PUT; completeUpload –≤—ã–ø–æ–ª–Ω—è–µ—Ç server-side –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∞–π–ª–∞ ‚Äî HEAD, content-type, —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç –∏ –ø–æ–ø—ã—Ç–∫—É —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ ImageIO. –ü—Ä–∏ –ª—é–±–æ–º –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (safeDeleteAndRemove). –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –≤—ã–∑–æ–≤—ã idempotent: –µ—Å–ª–∏ processed=true, —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –±–∏—Ç—ã—Ö/–ø–æ–¥–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –≥–æ–Ω–æ–∫ –∏ –¥–≤–æ–π–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- Presign –∏ completeUpload –∞—Ç–æ–º–∞—Ä–Ω–æ —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ attachmentId, —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äú—Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ –∑–∞–ø–∏—Å—å –Ω–µ —Å–æ–∑–¥–∞–Ω–∞‚Äù –∏–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ–Ω–∫–∏ –∏ —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã.
- –ü—É–±–ª–∏—á–Ω—ã–π URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É –ø–æ storageKey, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å CDN –∏ –º–µ–Ω—è—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫

**4) Production‚Äë–º–µ—Ö–∞–Ω–∏–∫–∏**

MDC, X‚ÄëRequest‚ÄëID, GlobalExceptionHandler —Å traceId, optimistic locking, idempotency, soft‚Äëdelete + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ S3, rate‚Äëlimit –Ω–∞ /auth/*.

**5) –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

Thin controllers ‚Üí transactional services ‚Üí repositories; DTO/Entity isolation; domain‚Äëfocused —Å–µ—Ä–≤–∏—Å—ã (Listing, Attachment, Auth, Admin).

**6) Idempotency & –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤**

Presign / complete / delete operations –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏ processed / removed –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π (@Version), —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥—É–±–ª–∏ –∏ race conditions.

**7) Error-contract**

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JSON –æ—à–∏–±–∫–∏ —Å traceId –∏ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏ –æ—à–∏–±–æ–∫, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –∏ DevOps –º–æ–≥–ª–∏ –±—ã—Å—Ç—Ä–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É. 
–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å–ø–∏—Å–æ–∫ –ø–æ–ª–µ–π + —Å–æ–æ–±—â–µ–Ω–∏–π)
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π fallback –¥–ª—è –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ audit-–ª–æ–≥–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ–±—ã—á–Ω—ã—Ö –ª–æ–≥–æ–≤
- MDC + X-Request-ID –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

**8) Rate-limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- `RateLimiterWrapper` + `RateLimitInterceptor` –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç per-endpoint –∏ per-key (IP –∏–ª–∏ user) –ª–∏–º–∏—Ç—ã.
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç brute-force –∏ DoS –∞—Ç–∞–∫–∏ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (/auth/*).
- –ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ endpoint (`capacity`, `refillAmount`, `refillDuration`).
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏ —á–µ—Ä–µ–∑ ConcurrentHashMap, –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 429 Too Many Requests –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞, —É–ª—É—á—à–∞—è UX –∏ –∑–∞—â–∏—â–∞—è —Å–µ—Ä–≤–∏—Å.

---

## üß≠ –ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –∫–ª–∞—Å—Å—ã

**Auth & Tokens**

* `JwtEngineImpl`, `JwtBeansConfig`, `AccessTokenService`, `RefreshTokenServiceImpl`.
* Refresh‚Äë—Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ HMAC(hash)+jti; `consume()` –ø–æ–º–µ—á–∞–µ—Ç `revoked` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
* –ö–µ—à–∏—Ä—É–µ–º—ã–π JWT‚Äë–ø–∞—Ä—Å–µ—Ä (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏ —Ä–æ—Ç–∞—Ü–∏–∏ –∫–ª—é—á–µ–π).

**Attachments / S3**

* `AttachmentServiceImpl` ‚Äî presignUrl, completeUpload (HEAD + getRange + ImageIO), —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (`processed=false`), –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.
* `S3StorageServiceImpl` ‚Äî presigned PUT, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞, —á—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç (getRange), –≥–µ–Ω–µ—Ä–∞—Ü–∏—è public URL, —É–¥–∞–ª–µ–Ω–∏–µ (best‚Äëeffort)
* `AttachmentProperties` ‚Äî presign TTL, maxFileSize, allowedContentTypes, OutboxMaxAttempts.

**Outbox / Async processing**

* `OutboxProcessor` ‚Äî claim/claimReadyEvents (–∫–æ—Ä–æ—Ç–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏), –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, batch, exponential backoff, maxAttempts ‚Üí dead‚Äëletter.
* `AttachmentOutboxDispatcher` ‚Äî –ø–∞—Ä—Å–∏—Ç payload, –≤—ã–∑—ã–≤–∞–µ—Ç `storage.delete(storageKey)`, –∑–∞—Ç–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

**Listings**

* `ListingServiceImpl` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ (attach attachments), partial update (PATCH semantics), publish validation, soft‚Äëdelete flow (attachments –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è –≤ outbox), atomic incrementViews.
* Entity: `UUID id`, `Money` (embeddable), `attributes` ‚Üí JSON —á–µ—Ä–µ–∑ `MapToJsonConverter`, `@Version` optimistic locking.

**Admin / Users**

* `AdminServiceImpl` ‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è, —Ñ–∏–ª—å—Ç—Ä—ã (Specifications), update roles (–≤–∞–ª–∏–¥a—Ü–∏—è), state‚Äëmachine –¥–ª—è AccountStatus.
* `User` —Å—É—â–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞ —Å RBAC 2 —É—Ä–æ–≤–Ω—è (Role + Permissions) –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏.

**Observability / Infra**

* `MDCFilter` (requestId, username), X‚ÄëRequest‚ÄëID, `GlobalExceptionHandler` (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON), `ArgumentResolver` –¥–ª—è Principal, rate‚Äëlimit interceptor.

---


## –°—Ç–µ–∫

Java 21 ¬∑ Spring Boot 3 (Web, Security, Data JPA, Actuator, Validation) ¬∑ PostgreSQL ¬∑ Liquibase ¬∑ AWS S3 SDK ¬∑ Bucket4j ¬∑ MapStruct ¬∑ Lombok ¬∑ Testcontainers

---
